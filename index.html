<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mid Class Sight Words Hero</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Andika&display=swap" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3406/3406828.png">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root { --bg-color: #fffcf2; --pink: #ffc2d1; --blue: #bde0fe; --green: #58cc02; }
        * { -webkit-tap-highlight-color: transparent; }
        
        body { 
            /* 2. å…¨åŸŸå¥—ç”¨ Andika å­—é«” */
            font-family: 'Andika', sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; 
            padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            box-sizing: border-box; 
            overflow: hidden;
        }

        #start-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.98); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 100; 
        }
        #start-btn { 
            padding: 25px 60px; font-size: 32px; border-radius: 60px; 
            background: #ffda08; border: none; cursor: pointer; 
            font-weight: bold; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            font-family: 'Andika', sans-serif; /* ç¢ºä¿æŒ‰éˆ•ä¹Ÿæ˜¯æ­£ç¢ºå­—é«” */
        }

        .star-container { font-size: 40px; height: 60px; margin: 10px 0; color: #ffcc00; }
        
        .button-container { display: flex; justify-content: center; gap: 30px; width: 100%; margin: 15px 0; }
        
        .word-btn { 
            width: 150px; height: 150px; border-radius: 50%; border: 8px solid white; 
            font-size: 42px; 
            font-weight: normal; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
            display: flex; align-items: center; justify-content: center; color: #444; cursor: pointer;
            transition: transform 0.2s;
            font-family: 'Andika', sans-serif;
        }
        
        .btn-pink { background-color: var(--pink); }
        .btn-blue { background-color: var(--blue); }
        .correct-anim { transform: scale(1.1); border-color: var(--green); }

        #controls { display: flex; flex-direction: column; align-items: center; gap: 12px; width: 100%; }
        .action-btn { 
            padding: 18px 30px; border-radius: 50px; border: 2px solid #ddd; 
            background-color: #fff; font-size: 20px; font-weight: bold; 
            width: 90%; max-width: 350px; cursor: pointer;
            font-family: 'Andika', sans-serif;
        }
        .record-btn { background-color: #ffd6a5; }
        .recording { background-color: #ff6b6b !important; color: white; animation: pulse 1s infinite; }
        .play-btn { background-color: #c1fba4; border-color: #A2D5AB; }
        #next-btn { background-color: var(--green); color: white; font-size: 26px; border: none; display: none; margin-top: 5px; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="start-overlay">
        <h1 style="margin-bottom: 30px; color: #555;">Sight Words Hero</h1>
        <button id="start-btn" onclick="startGame()">é»æˆ‘é–‹å§‹ç©ï¼</button>
    </div>

    <div id="header" style="font-size:26px; font-weight:bold; color:#555; margin-top:10px;">æ‰¾åˆ°æ­£ç¢ºçš„å–®å­—ï¼</div>
    <div class="star-container" id="star-display"></div>

    <div class="button-container">
        <button id="btn-left" class="word-btn btn-pink" onclick="checkAnswer(0)">...</button>
        <button id="btn-right" class="word-btn btn-blue" onclick="checkAnswer(1)">...</button>
    </div>

    <div id="controls">
        <button class="action-btn" onclick="playTargetWord()">ğŸ”ˆ å†è½ä¸€æ¬¡è€å¸«å”¸</button>
        <button id="record-btn" class="action-btn record-btn" onclick="toggleRecording()">ğŸ¤ éŒ„éŸ³ç·´ç¿’</button>
        <button id="play-record-btn" class="action-btn play-btn" onclick="playRecording()" style="display:none;">â–¶ï¸ è½æˆ‘çš„è²éŸ³</button>
        <button id="next-btn" class="action-btn" onclick="handleNextStep()">ğŸŒŸ ç­”å°äº†ï¼ä¸‹ä¸€é¡Œ</button>
    </div>

    <script>
        const wordList = ["I", "a", "it", "made", "on", "to", "not", "picnic", "in", "the", "see", "that", "how", "are", "you", "here", "go", "by", "will", "can", "was", "like", "so", "says", "have", "goes", "get", "where", "at", "who", "we", "and", "is", "this", "play", "with", "big"];
        let targetWord = "", currentOptions = [], stars = 0, mediaRecorder, audioChunks = [], canClick = true;
        
        // éŸ³æ•ˆè¨­å®š
        const victoryAudio = new Audio('https://www.myinstants.com/media/sounds/final-fantasy-vii-victory-fanfare-1.mp3');
        victoryAudio.preload = 'auto';

        function startGame() { 
            // éš±è—é–‹å§‹ç•«é¢
            document.getElementById('start-overlay').style.display = 'none'; 
            
            // iOS é‡è¦æ­¥é©Ÿï¼šåœ¨ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡é»æ“Šæ™‚ã€Œè§£é–ã€éŸ³æ•ˆæ’­æ”¾æ¬Šé™
            victoryAudio.play().then(() => { 
                victoryAudio.pause(); 
                victoryAudio.currentTime = 0;
            }).catch(() => {});
            
            window.speechSynthesis.cancel();
            initGame(); 
        }

        function initGame() {
            canClick = true;
            victoryAudio.pause();
            victoryAudio.currentTime = 0;
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('play-record-btn').style.display = 'none';
            document.getElementById('record-btn').innerText = "ğŸ¤ éŒ„éŸ³ç·´ç¿’";
            document.querySelectorAll('.word-btn').forEach(b => b.classList.remove('correct-anim'));
            
            const shuffled = [...wordList].sort(() => 0.5 - Math.random());
            currentOptions = [shuffled[0], shuffled[1]];
            targetWord = currentOptions[Math.floor(Math.random() * 2)];
            
            document.getElementById('btn-left').innerText = currentOptions[0];
            document.getElementById('btn-right').innerText = currentOptions[1];
            updateStars();
            
            setTimeout(playTargetWord, 500);
        }

        function handleNextStep() {
            victoryAudio.pause();
            victoryAudio.currentTime = 0;
            if (stars >= 5) stars = 0;
            initGame();
        }

        function playTargetWord() {
            window.speechSynthesis.cancel(); 
            const u = new SpeechSynthesisUtterance(targetWord);
            u.lang = 'en-US'; u.rate = 0.7; 
            window.speechSynthesis.speak(u);
        }

        function checkAnswer(index) {
            if (!canClick) return;
            if (currentOptions[index] === targetWord) {
                canClick = false;
                stars++;
                updateStars();
                document.getElementById(index === 0 ? 'btn-left' : 'btn-right').classList.add('correct-anim');
                document.getElementById('next-btn').style.display = 'block';
                if (stars >= 5) {
                    confetti({ particleCount: 400, spread: 120, origin: { y: 0.5 } });
                    victoryAudio.play();
                    document.getElementById('next-btn').innerText = "ğŸ‰ æŒ‘æˆ°æˆåŠŸï¼å†ç©ä¸€æ¬¡";
                } else {
                    confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
                    document.getElementById('next-btn').innerText = "ğŸŒŸ ç­”å°äº†ï¼ä¸‹ä¸€é¡Œ";
                }
            } else { 
                alert("å†è½ä¸€æ¬¡å–”ï¼æ˜¯ " + targetWord); 
                playTargetWord(); 
            }
        }

        function updateStars() { 
            document.getElementById('star-display').innerText = stars === 0 ? "åŠ æ²¹ï¼" : "â­".repeat(Math.min(stars, 5)); 
        }

        // --- iOS éŒ„éŸ³å„ªåŒ–å€å¡Š ---
        async function toggleRecording() {
            const btn = document.getElementById('record-btn');
            
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                btn.classList.remove('recording');
                btn.innerText = "âœ… éŒ„å¥½äº†";
            } else {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // åµæ¸¬ï¼šå„ªå…ˆä½¿ç”¨ mp4 (iOS)ï¼Œå¦å‰‡ä½¿ç”¨ webm (Android)
                    let options = { mimeType: 'audio/webm' };
                    if (MediaRecorder.isTypeSupported('audio/mp4')) {
                        options = { mimeType: 'audio/mp4' };
                    }
                    
                    mediaRecorder = new MediaRecorder(stream, options);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = e => {
                        if (e.data.size > 0) audioChunks.push(e.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        // ä½¿ç”¨æ­£ç¢ºçš„ MIME type å»ºç«‹ Blobï¼Œç¢ºä¿ iOS å¯æ’­æ”¾
                        const blob = new Blob(audioChunks, { type: mediaRecorder.mimeType });
                        window.recordedAudio = new Audio(URL.createObjectURL(blob));
                        document.getElementById('play-record-btn').style.display = 'block';
                    };
                    
                    mediaRecorder.start();
                    btn.classList.add('recording');
                    btn.innerText = "æ­£åœ¨éŒ„éŸ³...";
                    
                } catch (err) { 
                    console.error(err);
                    alert("ç„¡æ³•å­˜å–éº¥å…‹é¢¨ï¼Œè«‹ç¢ºèªï¼š\n1. ä½¿ç”¨ Safari é–‹å•Ÿ\n2. ç¶²å€é–‹é ­ç‚º HTTPS"); 
                }
            }
        }

        function playRecording() { 
            if (window.recordedAudio) {
                window.recordedAudio.play().catch(e => alert("æ’­æ”¾å¤±æ•—ï¼Œè«‹ç¢ºèªééœéŸ³æ¨¡å¼"));
            }
        }
    </script>
</body>
</html>
