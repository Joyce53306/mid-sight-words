<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sight Words å°è¶…äºº</title>
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3406/3406828.png">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --bg-color: #fffcf2; --pink: #ffc2d1; --blue: #bde0fe; }
        body { font-family: sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; box-sizing: border-box; }
        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        #start-btn { padding: 20px 50px; font-size: 30px; border-radius: 50px; background: #ffda08; border: none; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        #header { font-size: 24px; font-weight: bold; color: #555; }
        .star-container { font-size: 30px; height: 45px; margin: 10px 0; color: #ffcc00; }
        .button-container { display: flex; justify-content: center; gap: 20px; width: 100%; margin: 20px 0; }
        .word-btn { width: 140px; height: 140px; border-radius: 50%; border: 6px solid white; font-size: 28px; font-weight: bold; box-shadow: 0 8px 15px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; }
        .btn-pink { background-color: var(--pink); }
        .btn-blue { background-color: var(--blue); }
        #controls { display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%; }
        .action-btn { padding: 15px 30px; border-radius: 50px; border: 2px solid #ddd; background-color: #fff; font-size: 18px; font-weight: bold; width: 80%; max-width: 300px; }
        .record-btn { background-color: #ffd6a5; }
        .recording { background-color: #ff6b6b !important; color: white; }
        .play-btn { background-color: #c1fba4; }
    </style>
</head>
<body>

    <div id="start-overlay">
        <h2> à¤¤à¥ˆà¤¯à¤¾à¤° ready? </h2>
        <button id="start-btn" onclick="startGame()">é»æˆ‘é–‹å§‹ç©ï¼</button>
    </div>

    <div id="header">æ‰¾åˆ°æ­£ç¢ºçš„å–®å­—ï¼</div>
    <div class="star-container" id="star-display"></div>

    <div class="button-container">
        <button id="btn-left" class="word-btn btn-pink" onclick="checkAnswer(0)">...</button>
        <button id="btn-right" class="word-btn btn-blue" onclick="checkAnswer(1)">...</button>
    </div>

    <div id="controls">
        <button class="action-btn" onclick="playTargetWord()">ğŸ”ˆ å†è½ä¸€æ¬¡è€å¸«å”¸</button>
        <button id="record-btn" class="action-btn record-btn" onclick="toggleRecording()">ğŸ¤ éŒ„éŸ³ç·´ç¿’</button>
        <button id="play-record-btn" class="action-btn play-btn" onclick="playRecording()" style="display:none;">â–¶ï¸ è½æˆ‘çš„è²éŸ³</button>
    </div>

    <script>
        const wordList = ["I", "a", "it", "made", "on", "to", "not", "picnic", "in", "the", "see", "that", "how", "are", "you", "here", "go", "by", "will", "can", "was", "like", "so", "says", "have", "goes", "get", "where", "at", "who", "we", "and", "is", "this", "play", "with", "big"];
        let targetWord = "";
        let currentOptions = [];
        let stars = 0;
        let mediaRecorder;
        let audioChunks = [];

        // å•Ÿå‹•éŠæˆ²ï¼šé€éæ­¤é»æ“Šå‹•ä½œè§£é–èªéŸ³åŠŸèƒ½
        function startGame() {
            document.getElementById('start-overlay').style.display = 'none';
            // å˜—è©¦å–šé†’ç™¼éŸ³ç³»çµ±
            const welcome = new SpeechSynthesisUtterance("Let's play");
            welcome.volume = 0; // éœéŸ³ç™¼é€ï¼Œåªç‚ºäº†å–å¾—æ¬Šé™
            window.speechSynthesis.speak(welcome);
            initGame();
        }

        function initGame() {
            const shuffled = [...wordList].sort(() => 0.5 - Math.random());
            currentOptions = [shuffled[0], shuffled[1]];
            targetWord = currentOptions[Math.floor(Math.random() * 2)];
            document.getElementById('btn-left').innerText = currentOptions[0];
            document.getElementById('btn-right').innerText = currentOptions[1];
            document.getElementById('play-record-btn').style.display = 'none';
            updateStars();
            setTimeout(playTargetWord, 500);
        }

        function playTargetWord() {
            window.speechSynthesis.cancel(); 
            const utterance = new SpeechSynthesisUtterance(targetWord);
            utterance.lang = 'en-US';
            utterance.rate = 0.7;
            window.speechSynthesis.speak(utterance);
        }

        function checkAnswer(index) {
            if (currentOptions[index] === targetWord) {
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                stars++;
                updateStars();
                setTimeout(initGame, 1500);
            } else {
                alert("å†è½ä¸€æ¬¡å–”ï¼è€å¸«å”¸çš„æ˜¯ï¼š" + targetWord);
                playTargetWord();
            }
        }

        function updateStars() {
            const display = document.getElementById('star-display');
            display.innerText = stars === 0 ? "åŠ æ²¹ï¼" : "â­".repeat(stars);
        }

        async function toggleRecording() {
            const btn = document.getElementById('record-btn');
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                btn.classList.remove('recording');
                btn.innerText = "âœ… éŒ„å¥½äº†";
            } else {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        window.recordedAudio = new Audio(audioUrl);
                        document.getElementById('play-record-btn').style.display = 'block';
                    };
                    mediaRecorder.start();
                    btn.classList.add('recording');
                    btn.innerText = "æ­£åœ¨éŒ„éŸ³...";
                } catch (err) {
                    alert("è«‹é–‹å•Ÿéº¥å…‹é¢¨æ¬Šé™");
                }
            }
        }

        function playRecording() {
            if (window.recordedAudio) window.recordedAudio.play();
        }
    </script>
</body>
</html>
